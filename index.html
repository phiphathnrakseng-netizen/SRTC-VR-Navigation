<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SRTC VR Virtual | แผนผังและตึก 3D</title>
  <meta name="theme-color" content="#252525">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Color Palette (SRTC Theme) */
    :root {
      --color-primary: #252525; /* Dark Black/Gray for primary elements */
      --color-secondary: #FFC300; /* Gold/Yellow for accent */
      --color-text-dark: #252525;
      --color-text-muted: #6b7280;
      --color-background: #ffffff;
      --color-light-bg: #f5f5f5;
    }

    * { 
      font-family: 'Kanit', sans-serif;
      box-sizing: border-box;
    }
    body {
      overflow-x: hidden;
      /* Soft, clean background with subtle gradient */
      background: linear-gradient(135deg, var(--color-background) 0%, var(--color-light-bg) 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: var(--color-text-dark);
    }

    /* Header & Icon Buttons - Premium Glass */
    .icon-button {
      position: relative; 
      padding: 0.6rem; /* Slightly larger padding */
      border-radius: 9999px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      color: var(--color-primary); 
      transition: all 0.3s;
      /* Darker, more solid glass effect */
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 0, 0, 0.08);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .icon-button:hover { 
      transform: translateY(-2px) scale(1.05); 
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .glass-header {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 5px 25px rgba(0,0,0,0.1);
    }
    .badge {
      /* Use primary color for badges for better contrast */
      background: var(--color-primary); 
      color: #ffffff;
      font-size: 0.65rem; 
      padding: 2px 6px;
      font-weight: 600;
    }

    /* User Profile Buttons (Edit/Logout) */
    .user-profile-button {
      /* Consistent style with icon-button, but elongated */
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 1.5rem;
      padding: 0.4rem 0.75rem; /* Larger padding for text */
      display: flex; 
      align-items: center; 
      color: var(--color-primary);
      transition: all 0.3s;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 0, 0, 0.08);
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      font-weight: 500;
    }
    .user-profile-button:hover { 
      transform: scale(1.02); 
      background-color: rgba(255, 255, 255, 0.9);
    }
    
    /* Liquid Glass Design - Enhanced */
    .liquid-glass {
      background: rgba(255, 255, 255, 0.85); /* More opaque */
      backdrop-filter: blur(25px); /* Stronger blur */
      border-radius: 1.5rem; /* Slightly larger radius */
      border: 1px solid rgba(0, 0, 0, 0.08);
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.9); /* Stronger inner highlight */
    }
    
    .liquid-glass-card {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(30px);
      border-radius: 1.25rem;
      border: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: 
        0 12px 35px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.9);
      transition: all 0.3s ease;
    }
    
    .liquid-glass-card:hover {
      transform: translateY(-5px);
      box-shadow: 
        0 25px 50px rgba(0, 0, 0, 0.18),
        inset 0 1px 0 rgba(255, 255, 255, 1);
      background: rgba(255, 255, 255, 0.9);
    }

    /* CTA Button - Primary Focus */
    .cta-button {
      /* Solid Dark Color for Primary Action */
      background: var(--color-primary);
      color: #ffffff;
      font-weight: 600;
      padding: 0.75rem 1.5rem; /* Larger for better tap target */
      border-radius: 9999px;
      box-shadow: 0 10px 30px rgba(37, 37, 37, 0.3);
      transition: all 0.3s ease;
      border: none;
      font-size: 1rem;
    }
    .cta-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(37, 37, 37, 0.4);
      background: #404040;
    }

    /* Secondary CTA Button (e.g., AR Mode) */
    .cta-button-secondary {
      background: rgba(255, 255, 255, 0.7);
      color: var(--color-primary);
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 9999px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      border: 1px solid rgba(0, 0, 0, 0.1);
      font-size: 1rem;
      backdrop-filter: blur(10px);
    }
    .cta-button-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
      background: rgba(255, 255, 255, 0.9);
    }
    
    /* Activity Points Pill */
    .points-pill {
      background: var(--color-secondary); /* Use gold accent color */
      color: var(--color-primary);
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 9999px;
      font-size: 0.75rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Registration Button (The Profile Icon) */
    .registration-button {
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 1.5rem;
      padding: 0.3rem 0.6rem 0.3rem 0.3rem; /* Adjusted for better look */
      border: 1px solid rgba(0, 0, 0, 0.08);
      transition: all 0.3s;
    }
    .registration-button:hover { 
      transform: scale(1.02); 
      background-color: rgba(255, 255, 255, 0.9);
    }
    .registration-button .user-avatar {
      border: 1px solid var(--color-secondary); /* Highlight avatar with accent color */
    }
    
    /* Form Input Enhancements */
    .form-input {
      border: 1px solid #d1d5db;
      border-radius: 0.75rem; /* Slightly rounder */
      padding: 0.75rem; /* Larger padding */
      background-color: rgba(255, 255, 255, 0.9);
      font-size: 0.9rem;
    }
    .form-input:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(37, 37, 37, 0.1);
    }
    
    /* Utility classes for text colors */
    .text-dark { color: var(--color-text-dark); }
    .text-muted { color: var(--color-text-muted); }
    .text-accent { color: var(--color-secondary); }
    
    /* Modal Enhancements */
    .modal-content {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 1.5rem;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    /* Responsive Adjustments for better UX */
    @media (max-width: 640px) {
      .icon-button { padding: 0.5rem; }
      .user-profile-button span, .registration-button .user-name { display: none !important; } /* Hide text on small screens for cleaner header */
      .user-profile-button { padding: 0.5rem; width: 2.5rem; height: 2.5rem; }
      .user-profile-button i { margin-right: 0 !important; }
      .registration-button { padding: 0.5rem; width: 2.5rem; height: 2.5rem; }
      .registration-button .user-avatar { margin-right: 0; }
      .cta-button, .cta-button-secondary { font-size: 0.9rem; padding: 0.6rem 1.25rem; }
      .features-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
    }
  </style>
</head>

<body class="text-dark">
    <header class="glass-header sticky top-0 z-20">
    <div class="flex justify-between items-center px-4 sm:px-6 py-3">
      <div class="flex items-center space-x-3">
        <img src="https://www.srtc.ac.th/2020/images/images.jpg" class="h-9 w-9 rounded-full ring-2 ring-gray-300 shadow-md" alt="SRTC Logo"/>
        <h1 class="text-base sm:text-xl font-extrabold text-dark tracking-tight">SRTC VR <span class="text-accent">|</span> Guide</h1>
      </div>

      <nav class="flex items-center space-x-2 sm:space-x-3">
                <button onclick="openQRModal()" class="icon-button" title="QR Code">
          <i data-lucide="qr-code" class="w-5 h-5"></i>
        </button>
        <button onclick="toggleARMode()" class="icon-button" title="เปิดโหมด AR/VR">
          <i data-lucide="scan" class="w-5 h-5"></i>
        </button>
        <button onclick="openNotification()" class="icon-button" title="แจ้งเตือน">
          <i data-lucide="bell" class="w-5 h-5"></i>
          <span id="notif-badge" class="badge hidden">1</span>
        </button>

                <button onclick="openPointsModal()" class="icon-button" title="แต้มสะสม">
          <i data-lucide="coins" class="w-5 h-5 text-accent"></i>
          <span id="points-badge" class="badge hidden">0</span>
        </button>

                <button id="edit-profile-btn" onclick="editProfile()" class="user-profile-button hidden">
          <i data-lucide="edit-3" class="w-4 h-4 mr-1"></i>
          <span class="text-sm font-medium hidden sm:inline">โปรไฟล์</span>
        </button>
        <button id="logout-btn-header" onclick="userLogout()" class="user-profile-button hidden !bg-red-500/10 hover:!bg-red-500/20">
          <i data-lucide="log-out" class="w-4 h-4 mr-1 text-red-600"></i>
          <span class="text-sm font-medium text-red-600 hidden sm:inline">ออก</span>
        </button>

                <button id="registration-btn" onclick="toggleRegistrationMenu()" class="registration-button relative">
          <div id="registration-default" class="flex items-center">
            <i data-lucide="user-plus" class="w-5 h-5"></i>
            <span class="ml-2 text-sm font-medium hidden sm:inline">ลงทะเบียน</span>
          </div>
          <div id="registration-user" class="user-info hidden flex items-center gap-1.5">
            <img id="user-avatar" class="user-avatar w-6 h-6" />
            <span id="user-name" class="user-name text-sm font-semibold mr-1"></span>
            <i data-lucide="chevron-down" class="w-3 h-3 hidden sm:inline"></i>
          </div>
          
                    <div id="registration-menu" class="registration-menu">
            <div class="user-details">
              <div id="menu-user-name" class="name"></div>
              <div id="menu-user-email" class="email"></div>
            </div>
          </div>
        </button>
      </nav>
    </div>
  </header>

    <main class="flex-grow compact-layout px-4 py-6">
        <section class="hero-section">
      <div class="hero-content">
        <h2 class="text-3xl sm:text-5xl font-extrabold mb-4 text-dark leading-tight">
          <span class="text-accent">SRTC</span> Virtual <br class="sm:hidden"/> Campus Navigation
        </h2>
        <p class="text-lg text-muted mb-8 max-w-3xl mx-auto font-medium">สัมผัสประสบการณ์นำทาง **3 มิติ** และ **AR** ภายในวิทยาลัยเทคนิคสุราษฎร์ธานี</p>
        
        <div class="flex flex-col sm:flex-row gap-3 justify-center mb-10">
          <button onclick="showMap()" class="cta-button">
            <i data-lucide="map" class="w-5 h-5 mr-2"></i>
            <span>สำรวจแผนผัง 3D</span>
          </button>
          
          <button onclick="toggleARMode()" class="cta-button-secondary">
            <i data-lucide="scan" class="w-5 h-5 mr-2"></i>
            <span>เปิดโหมด AR/VR</span>
          </button>
        </div>
        
                <div class="features-grid">
          <div class="liquid-glass-card p-5 text-center">
            <i data-lucide="map-pin" class="w-8 h-8 mx-auto mb-2 text-primary"></i>
            <h3 class="text-base font-semibold mb-1">นำทางเรียลไทม์</h3>
            <p class="text-muted text-sm">ค้นหาสถานที่สำคัญได้อย่างรวดเร็ว</p>
          </div>
          
          <div class="liquid-glass-card p-5 text-center">
            <i data-lucide="box" class="w-8 h-8 mx-auto mb-2 text-primary"></i>
            <h3 class="text-base font-semibold mb-1">โมเดล 3D อาคาร</h3>
            <p class="text-muted text-sm">สำรวจโครงสร้างและรายละเอียดเสมือนจริง</p>
          </div>
          
          <div class="liquid-glass-card p-5 text-center">
            <i data-lucide="camera" class="w-8 h-8 mx-auto mb-2 text-primary"></i>
            <h3 class="text-base font-semibold mb-1">Augmented Reality</h3>
            <p class="text-muted text-sm">ซ้อนทับข้อมูลสถานที่บนโลกแห่งความจริง</p>
          </div>
        </div>
        
                <div id="activities-section" class="activity-section liquid-glass hidden p-6">
          <h2 class="text-2xl font-bold text-center mb-3">กิจกรรมรับคะแนนพิเศษ <i data-lucide="star" class="w-5 h-5 inline text-accent"></i></h2>
          <p class="text-muted text-center mb-5 text-base">ร่วมทำกิจกรรมเพื่อสะสมคะแนนและแลกรับของรางวัล</p>
          
          <div class="activity-grid">
                        <div class="liquid-glass-card activity-card" onclick="toggleActivityDetail('activity-1')">
              <div class="flex items-center mb-2">
                <i data-lucide="map" class="w-6 h-6 text-primary mr-3"></i>
                <h3 class="text-lg font-bold">สำรวจแผนที่ 3D</h3>
              </div>
              <p class="text-muted text-sm mb-3">ทำความคุ้นเคยกับพื้นที่วิทยาลัยผ่านมุมมอง 3 มิติ</p>
              <div class="flex justify-between items-center">
                <span class="points-pill">+20 คะแนน</span>
                <i data-lucide="chevron-down" class="w-4 h-4 text-primary transition-transform" id="chevron-1"></i>
              </div>
              <div class="activity-detail mt-3" id="activity-1">
                <div class="border-t border-gray-200 pt-3">
                  <h4 class="font-bold mb-2 text-sm">วิธีการเข้าร่วม:</h4>
                  <ul class="list-disc list-inside text-muted text-sm space-y-1 mb-3">
                    <li>เข้าสู่โหมดแผนผัง 3D</li>
                    <li>หมุนดูและซูมอินอาคารหลักอย่างน้อย 3 อาคาร</li>
                  </ul>
                  <button onclick="completeActivity('สำรวจแผนที่ 3D', 20)" class="w-full bg-primary text-white py-2 rounded-xl font-semibold hover:bg-gray-700 transition-all text-sm shadow-md">
                    <i data-lucide="zap" class="w-4 h-4 inline mr-1"></i>
                    รับคะแนนทันที
                  </button>
                </div>
              </div>
            </div>
            
                        <div class="liquid-glass-card activity-card" onclick="toggleActivityDetail('activity-2')">
              <div class="flex items-center mb-2">
                <i data-lucide="scan" class="w-6 h-6 text-primary mr-3"></i>
                <h3 class="text-lg font-bold">ทดลองใช้ AR Navigation</h3>
              </div>
              <p class="text-muted text-sm mb-3">เปิดโหมด AR และสแกน Marker ที่กำหนด</p>
              <div class="flex justify-between items-center">
                <span class="points-pill">+30 คะแนน</span>
                <i data-lucide="chevron-down" class="w-4 h-4 text-primary transition-transform" id="chevron-2"></i>
              </div>
              <div class="activity-detail mt-3" id="activity-2">
                <div class="border-t border-gray-200 pt-3">
                  <h4 class="font-bold mb-2 text-sm">วิธีการเข้าร่วม:</h4>
                  <ul class="list-disc list-inside text-muted text-sm space-y-1 mb-3">
                    <li>เปิดโหมด AR</li>
                    <li>สแกนป้าย "SRTC AR Marker" บริเวณอาคารอำนวยการ</li>
                  </ul>
                  <button onclick="completeActivity('ทดลองใช้ AR', 30)" class="w-full bg-primary text-white py-2 rounded-xl font-semibold hover:bg-gray-700 transition-all text-sm shadow-md">
                    <i data-lucide="zap" class="w-4 h-4 inline mr-1"></i>
                    รับคะแนนทันที
                  </button>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </section>

        <section id="registration-section" class="py-6 liquid-glass hidden mt-6">
      <div class="max-w-4xl mx-auto px-4">
        <h2 class="text-2xl font-bold text-center mb-5">ลงทะเบียนผู้ใช้งาน <span class="text-accent">SRTC Guide</span></h2>
        <div class="registration-form liquid-glass-card p-6">
          <form id="registration-form">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                            <div>
                <label class="block text-dark mb-1 font-semibold text-sm" for="student-id">รหัสนักศึกษา/บุคลากร</label>
                <input type="text" id="student-id" class="form-input" placeholder="ระบุรหัสประจำตัว" required>
              </div>
              <div>
                <label class="block text-dark mb-1 font-semibold text-sm" for="fullname">ชื่อ-นามสกุล</label>
                <input type="text" id="fullname" class="form-input" placeholder="ชื่อ-นามสกุล" required>
              </div>
            </div>
            
            <div class="mb-3">
              <label class="block text-dark mb-1 font-semibold text-sm" for="email">อีเมล</label>
              <input type="email" id="email" class="form-input" placeholder="อีเมลสำหรับติดต่อ" required>
            </div>
            
                        <div class="mb-5">
              <label class="block text-dark mb-2 font-semibold text-sm">อัพโหลดรูปโปรไฟล์ (ไม่บังคับ)</label>
              <div class="file-upload" id="file-upload-area">
                <i data-lucide="upload-cloud" class="w-6 h-6 file-upload-icon"></i>
                <p class="text-muted text-sm text-center font-medium">คลิกเพื่ออัพโหลด<br>หรือลากไฟล์รูปภาพมาวาง</p>
                <input type="file" id="file-input" class="hidden" accept="image/*">
              </div>
              <div id="file-preview" class="hidden mt-3 text-center">
                <img id="preview-image" class="h-16 w-16 rounded-full mx-auto object-cover border-2 border-accent shadow-lg">
                <p id="file-name" class="text-center text-xs text-muted mt-1.5"></p>
              </div>
            </div>
            
                        <button type="submit" class="w-full bg-primary text-white py-3 rounded-2xl font-bold hover:bg-gray-700 transition-all text-base shadow-xl">
              <i data-lucide="check-circle" class="w-4 h-4 inline mr-1"></i>
              ยืนยันการลงทะเบียน
            </button>
          </form>
        </div>
        
        <div class="text-center mt-4">
          <button onclick="hideRegistration()" class="cta-button-secondary py-2 px-4 text-sm">
            <i data-lucide="x" class="w-4 h-4 inline mr-1"></i>
            ปิดหน้าลงทะเบียน
          </button>
        </div>
      </div>
    </section>

        <section id="map-section" class="py-6 liquid-glass hidden mt-6">
      <div class="max-w-4xl mx-auto px-4">
        <h2 class="text-2xl font-bold text-center mb-4">แผนผังอาคาร 3D <span class="text-accent">Virtual Campus</span></h2>
        <div id="aframe-container" class="w-full h-80 rounded-2xl overflow-hidden shadow-2xl border border-gray-200">
          <a-scene embedded>
            <a-box position="0 0.5 -3" rotation="0 45 0" color="#333333" shadow></a-box>
            <a-sphere position="2 1 -5" radius="1.25" color="#FFC300" shadow></a-sphere>
            <a-cylinder position="-1 0.75 -3" radius="0.5" height="1.5" color="#555555" shadow></a-cylinder>
            <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#e0e0e0" shadow></a-plane>
            <a-sky color="#f9f9f9"></a-sky>
            <a-light type="ambient" color="#fff" intensity="0.5"></a-light>
            <a-light type="directional" color="#fff" intensity="0.8" position="5 10 10"></a-light>
          </a-scene>
        </div>
        <div class="text-center mt-4">
          <button onclick="hideMap()" class="cta-button-secondary py-2 px-4 text-sm">
            <i data-lucide="x" class="w-4 h-4 inline mr-1"></i>
            ปิดแผนที่ 3D
          </button>
        </div>
      </div>
    </section>
  </main>

    <footer class="footer">
    <div class="container mx-auto">
      <p class="text-dark text-xs font-semibold">© 2025 SRTC Virtual Campus | All rights reserved.</p>
      <p class="text-xs text-muted mt-0.5">วิทยาลัยเทคนิคสุราษฎร์ธานี - นวัตกรรมนำทางเพื่อนักเรียนและบุคลากร</p>
    </div>
  </footer>

    <div id="qr-modal" class="modal">
    <div class="modal-content max-w-xs p-5">
      <button onclick="closeQRModal()" class="absolute top-3 right-3 text-gray-500 hover:text-primary">
        <i data-lucide="x" class="w-5 h-5"></i>
      </button>
      <h3 class="font-bold text-xl mb-3">สแกน QR Code</h3>
      <div id="qrcode" class="mx-auto mb-3 p-2 bg-white rounded-lg border border-gray-200"></div>
      <p class="text-sm text-muted">สแกนเพื่อเข้าสู่ระบบนำทาง AR/VR ได้ทันที</p>
    </div>
  </div>

  <div id="points-modal" class="modal">
    <div class="modal-content points-modal p-5">
      <button onclick="closePointsModal()" class="absolute top-3 right-3 text-gray-500 hover:text-primary">
        <i data-lucide="x" class="w-5 h-5"></i>
      </button>
      <h3 class="font-bold text-xl mb-3 flex items-center justify-center">
        <i data-lucide="star" class="w-5 h-5 text-accent mr-2"></i> คะแนนสะสม
      </h3>
      <div id="points-list" class="max-h-60 overflow-y-auto mb-3">
              </div>
      <div class="mt-4 pt-3 border-t border-gray-300">
        <div class="flex justify-between items-center">
          <span class="font-bold text-lg">คะแนนรวมทั้งหมด</span>
          <span id="total-points" class="font-extrabold text-2xl text-primary">0</span>
        </div>
      </div>
    </div>
  </div>

    <div id="webcam-error-modal" class="webcam-error">
    <div class="webcam-error-content p-6">
      <i data-lucide="alert-triangle" class="w-8 h-8 text-red-500 mx-auto mb-3"></i>
      <h3>ไม่สามารถเข้าถึงกล้องได้</h3>
      <p>โปรดตรวจสอบว่าคุณได้ให้สิทธิ์การเข้าถึงกล้องสำหรับเว็บไซต์นี้ เพื่อใช้งานโหมด AR/VR</p>
      <button onclick="closeWebcamError()" class="bg-primary text-white py-2 px-6 rounded-lg font-semibold mt-2 hover:bg-gray-700 transition-all">
        ตกลง
      </button>
    </div>
  </div>

    <div id="ar-view">
        <a-scene embedded
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; detectionMode: mono; cameraParametersUrl: https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/camera-parameters.patt;"
      id="ar-scene">
      
      <a-marker preset="hiro" id="ar-marker">
                <a-torus-knot radius="0.5" tube="0.2" p="2" q="3" color="#FFC300" material="shader: standard; metalness: 0.9; roughness: 0.05;" rotation="0 0 0" animation="property: rotation; to: 360 360 0; loop: true; dur: 3000; easing: linear;"></a-torus-knot>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>
    
        <div class="absolute top-0 left-0 right-0 p-3 flex justify-between items-start z-50">
      <button onclick="exitARMode()" class="bg-primary text-white px-4 py-2 rounded-full text-sm font-semibold shadow-xl">
        <i data-lucide="x" class="w-4 h-4 inline mr-1"></i>
        ออกจาก AR
      </button>
    </div>
  </div>


  <script>
    // JavaScript Functions (Unchanged logic, ensures features work with new UI)
    
    document.addEventListener('DOMContentLoaded', () => {
      lucide.createIcons();
      // Example initial login state
      updateRegistrationStatus(true, 'สมชาย เก่งมาก', 'somchai.k@srtc.ac.th', 'https://via.placeholder.com/150/FFC300/252525?text=SK');
    });

    // Global State (Dummy)
    let isUserLoggedIn = false;
    let userPoints = 0;
    let userActivities = [];

    // Helper to update registration buttons (Crucial for the user request)
    function updateRegistrationStatus(isLoggedIn, userName = '', userEmail = '', userAvatar = '') {
      const regDefault = document.getElementById('registration-default');
      const regUser = document.getElementById('registration-user');
      const editBtn = document.getElementById('edit-profile-btn');
      const logoutBtn = document.getElementById('logout-btn-header');
      const activitiesSection = document.getElementById('activities-section');
      const nameDisplay = userName.split(' ')[0]; // Use first name for compact display

      isUserLoggedIn = isLoggedIn;

      if (isLoggedIn) {
        regDefault.classList.add('hidden');
        regUser.classList.remove('hidden');
        
        // 🚩 แสดงปุ่มที่ย้ายมาใหม่
        editBtn.classList.remove('hidden'); 
        logoutBtn.classList.remove('hidden');

        // อัปเดตข้อมูลในปุ่มหลักและเมนูย่อย
        document.getElementById('user-name').textContent = nameDisplay;
        document.getElementById('user-avatar').src = userAvatar;
        document.getElementById('menu-user-name').textContent = userName;
        document.getElementById('menu-user-email').textContent = userEmail;

        // แสดงส่วนกิจกรรม
        activitiesSection.classList.remove('hidden');

      } else {
        regDefault.classList.remove('hidden');
        regUser.classList.add('hidden');
        
        // 🚩 ซ่อนปุ่มที่ย้ายมาใหม่
        editBtn.classList.add('hidden');
        logoutBtn.classList.add('hidden');

        // ซ่อนส่วนกิจกรรม
        activitiesSection.classList.add('hidden');

        // ปิดเมนูย่อยถ้าเปิดอยู่
        document.getElementById('registration-menu').classList.remove('show');
        
        // ซ่อนหน้าลงทะเบียน/แผนที่ ถ้าเปิดอยู่
        hideRegistration();
        hideMap();
      }
    }

    function toggleRegistrationMenu() {
      const menu = document.getElementById('registration-menu');
      if (!isUserLoggedIn) {
        showRegistration();
        return;
      }
      menu.classList.toggle('show');
    }

    function userLogout() {
      if (confirm('คุณต้องการออกจากระบบหรือไม่?')) {
        alert('ออกจากระบบแล้ว!');
        updateRegistrationStatus(false);
      }
    }

    function editProfile() {
      alert('เปิดหน้าแก้ไขโปรไฟล์ (ฟังก์ชันยังไม่ได้พัฒนา)');
      document.getElementById('registration-menu').classList.remove('show');
    }
    
    function showRegistration() {
      document.getElementById('registration-section').classList.remove('hidden');
      document.getElementById('map-section').classList.add('hidden');
    }
    
    function hideRegistration() {
      document.getElementById('registration-section').classList.add('hidden');
    }

    function showMap() {
      document.getElementById('map-section').classList.remove('hidden');
      document.getElementById('registration-section').classList.add('hidden');
    }

    function hideMap() {
      document.getElementById('map-section').classList.add('hidden');
    }

    function openQRModal() {
      const modal = document.getElementById('qr-modal');
      modal.classList.add('show');
      
      const qrDiv = document.getElementById('qrcode');
      if (qrDiv.innerHTML === '') {
        new QRCode(qrDiv, {
          text: window.location.href,
          width: 150, // Larger QR Code
          height: 150,
          colorDark : "#252525",
          colorLight : "#ffffff",
          correctLevel : QRCode.CorrectLevel.H
        });
      }
    }

    function closeQRModal() {
      document.getElementById('qr-modal').classList.remove('show');
    }

    function openPointsModal() {
      if (!isUserLoggedIn) {
        alert('กรุณาลงทะเบียนก่อนดูคะแนนสะสม');
        showRegistration();
        return;
      }

      // Ensure initial points are set if logged in but no activity
      if (userActivities.length === 0) {
        userActivities.push({ name: 'คะแนนเริ่มต้นต้อนรับ', points: 5 });
        userPoints = 5;
      }

      const list = document.getElementById('points-list');
      list.innerHTML = '';
      userActivities.forEach(activity => {
        const item = document.createElement('div');
        item.className = 'points-item text-sm bg-gray-50/50 rounded-lg p-2 mb-1 shadow-sm border border-gray-100';
        item.innerHTML = `
          <span>${activity.name}</span>
          <span class="font-bold text-base text-primary">+${activity.points}</span>
        `;
        list.appendChild(item);
      });

      document.getElementById('total-points').textContent = userPoints;
      document.getElementById('points-modal').classList.add('show');
    }

    function closePointsModal() {
      document.getElementById('points-modal').classList.remove('show');
    }

    function openNotification() {
      alert('เปิดหน้าแจ้งเตือน (ฟังก์ชันยังไม่ได้พัฒนา)');
      document.getElementById('notif-badge').classList.add('hidden');
    }

    function toggleActivityDetail(id) {
      const detail = document.getElementById(id);
      const chevron = document.getElementById(`chevron-${id.split('-')[1]}`);
      
      // Close others
      document.querySelectorAll('.activity-detail.expanded').forEach(d => {
        if (d.id !== id) {
          d.classList.remove('expanded');
          document.getElementById(`chevron-${d.id.split('-')[1]}`).classList.remove('rotate-180');
        }
      });
      
      detail.classList.toggle('expanded');
      chevron.classList.toggle('rotate-180');
    }

    function completeActivity(name, points) {
      if (!isUserLoggedIn) {
        alert('กรุณาลงทะเบียนก่อนเข้าร่วมกิจกรรม');
        showRegistration();
        return;
      }
      
      if (userActivities.some(activity => activity.name === name)) {
        alert(`คุณได้ทำกิจกรรม "${name}" ไปแล้ว`);
        return;
      }

      userPoints += points;
      userActivities.push({ name, points });
      
      document.getElementById('points-badge').textContent = userPoints;
      document.getElementById('points-badge').classList.remove('hidden');
      
      alert(`ยินดีด้วย! คุณได้รับ +${points} คะแนนจากกิจกรรม "${name}"`);
    }
    
    function showWebcamError() {
      document.getElementById('webcam-error-modal').classList.add('show');
    }

    function closeWebcamError() {
      document.getElementById('webcam-error-modal').classList.remove('show');
    }

    function toggleARMode() {
      const arView = document.getElementById('ar-view');
      if (arView.style.display === 'flex') {
        exitARMode();
      } else {
        enterARMode();
      }
    }

    function enterARMode() {
      // Simplified AR entry for this example
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        showWebcamError();
        return;
      }

      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          stream.getTracks().forEach(track => track.stop());

          // Hide main content
          document.querySelector('header').style.display = 'none';
          document.querySelector('main').style.display = 'none';
          document.querySelector('footer').style.display = 'none';

          document.getElementById('ar-view').style.display = 'flex';
        })
        .catch(err => {
          console.error("Error accessing camera: ", err);
          showWebcamError();
        });
    }

    function exitARMode() {
      document.getElementById('ar-view').style.display = 'none';
      document.querySelector('header').style.display = 'block';
      document.querySelector('main').style.display = 'block';
      document.querySelector('footer').style.display = 'block';
    }

    // File Upload
    document.getElementById('file-upload-area').addEventListener('click', () => {
      document.getElementById('file-input').click();
    });

    document.getElementById('file-input').addEventListener('change', (event) => {
      const file = event.target.files[0];
      const preview = document.getElementById('file-preview');
      const image = document.getElementById('preview-image');
      const fileName = document.getElementById('file-name');

      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          image.src = e.target.result;
          fileName.textContent = file.name;
          preview.classList.remove('hidden');
          document.getElementById('file-upload-area').classList.add('hidden');
        };
        reader.readAsDataURL(file);
      } else {
        preview.classList.add('hidden');
        document.getElementById('file-upload-area').classList.remove('hidden');
      }
    });

    // Registration Form Submission (Dummy)
    document.getElementById('registration-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const fullname = document.getElementById('fullname').value;
      const email = document.getElementById('email').value;
      
      alert(`ลงทะเบียนสำเร็จ! ยินดีต้อนรับ ${fullname}`);
      
      updateRegistrationStatus(true, fullname, email, 'https://via.placeholder.com/150/FFC300/252525?text=' + fullname.substring(0, 1) + fullname.split(' ')[1].substring(0, 1));
      
      hideRegistration();
      
      e.target.reset();
      document.getElementById('file-preview').classList.add('hidden');
      document.getElementById('file-upload-area').classList.remove('hidden');
    });
  </script>
</body>
</html>
