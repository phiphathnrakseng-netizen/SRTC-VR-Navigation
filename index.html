<!DOCTYPE html>

<html lang="th">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <title>SRTC VR Navigation - AR Camera PWA</title>

    

    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="theme-color" content="#3730A3"> <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode.js/1.0.0/qrcode.min.js"></script>

    

    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>

        /* กำหนดฟอนต์หลักและให้องค์ประกอบใช้ขอบมน */

        * {

            font-family: 'Kanit', sans-serif;

        }

        .rounded-xl {

            border-radius: 0.75rem;

        }

        /* แก้ไขเพื่อให้ body และ container หลักครอบคลุมเต็มจอเสมอ */

        html, body {

            height: 100%; /* สำคัญสำหรับการแสดงผลเต็มจอ */

            margin: 0;

            overflow-x: hidden; /* ป้องกันการเลื่อนแนวนอน */

        }

        /* .min-h-screen ถูกแทนที่ด้วย h-full ใน div หลัก */

    </style>

</head>

<body class="bg-gray-50 h-full antialiased flex flex-col">



<div id="home-section" class="flex flex-col flex-grow">

    <header class="bg-indigo-900 shadow-lg sticky top-0 z-10">

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">

            

            <div class="flex items-center space-x-3">

                <img src="https://upload.wikimedia.org/wikipedia/th/a/a2/Suratthani_Technical_College_Logo.png" alt="SRTC Logo" class="h-8 w-8 sm:h-10 sm:w-10">

                <h1 class="text-xl sm:text-2xl font-bold text-white tracking-wide">SRTC VR Navigation</h1>

            </div>

            

            <nav class="space-x-2 sm:space-x-4 flex items-center">

                <a href="#" class="text-white hover:text-indigo-200 transition duration-150 hidden lg:inline-block">หน้าแรก</a>

                <a href="#" class="text-white hover:text-indigo-200 transition duration-150 hidden lg:inline-block">แผนผัง</a>

                

                <button onclick="showModal('install-qr-modal')" class="bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-semibold py-2 px-3 sm:px-4 rounded-full shadow-md flex items-center space-x-2 transform transition duration-200 hover:scale-105">

                    <i data-lucide="qr-code" class="w-4 h-4 sm:w-5 sm:h-5"></i>

                    <span class="text-xs sm:text-sm hidden sm:inline">QR Code</span>

                </button>



                <button onclick="showModal('install-qr-modal')" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-3 sm:px-4 rounded-full shadow-md flex items-center space-x-2 transform transition duration-200 hover:scale-105">

                    <i data-lucide="smartphone" class="w-4 h-4 sm:w-5 sm:h-5"></i>

                    <span class="text-xs sm:text-sm hidden sm:inline">ติดตั้ง App</span>

                </button>



                <button onclick="toggleVRMode()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-3 sm:px-4 rounded-full shadow-md flex items-center space-x-2 transform transition duration-200 hover:scale-105">

                    <i data-lucide="scan" class="w-4 h-4 sm:w-5 sm:h-5"></i>

                    <span class="text-xs sm:text-sm">VR (AR)</span>

                </button>

            </nav>

        </div>

    </header>



    <section class="relative flex-grow flex items-center justify-center text-center overflow-hidden h-[70vh] lg:h-[80vh] min-h-[400px]">

        <img 

            src="https://console.kr-asia.com/wp-content/uploads/2023/06/medium-shot-man-wearing-vr-glasses-scaled.jpg" 

            alt="Man wearing VR glasses background" 

            class="absolute inset-0 h-full w-full object-cover"

        >

        <div class="absolute inset-0 bg-indigo-900/70"></div>

        

        <div class="relative z-10 max-w-xl p-6">

            <h2 class="text-4xl sm:text-5xl font-extrabold text-white mb-4 leading-tight">ค้นหาและนำทางห้องเรียนอัจฉริยะ</h2>

            <p class="text-xl text-indigo-200 mb-8">สัมผัสประสบการณ์นำทางแบบ AR/VR ที่รวดเร็วและแม่นยำ</p>

            

            <div class="flex rounded-full shadow-2xl overflow-hidden">

                <input type="text" placeholder="ค้นหาห้องเรียน เช่น 201, ห้องปฏิบัติการคอมพิวเตอร์" class="w-full py-3 px-6 text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150" aria-label="Search">

                <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 transition duration-150 flex items-center space-x-2">

                    <i data-lucide="search" class="w-5 h-5"></i>

                    <span class="hidden sm:inline">ค้นหา</span>

                </button>

            </div>

        </div>

    </section>



    <footer class="bg-gray-800 text-white py-4 mt-auto">

        <div class="text-center text-sm">

            © 2025 วิทยาลัยเทคนิคสุราษฎร์ธานี - ระบบ VR Navigation

        </div>

    </footer>

</div>



<div id="install-qr-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">

    <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full p-6 sm:p-8">

        <div class="flex justify-between items-start mb-4">

            <h3 class="text-2xl font-bold text-indigo-700 flex items-center">

                <i data-lucide="download-cloud" class="w-6 h-6 mr-2"></i>

                ติดตั้งแอปพลิเคชัน / สแกน QR Code

            </h3>

            <button onclick="hideModal('install-qr-modal')" class="text-gray-400 hover:text-gray-600 transition">

                <i data-lucide="x" class="w-6 h-6"></i>

            </button>

        </div>

        

        <p class="text-gray-600 mb-6">คุณสามารถติดตั้งแอปพลิเคชันนี้บนมือถือของคุณได้ด้วยวิธีใดวิธีหนึ่งด้านล่างนี้:</p>



        <div class="bg-indigo-50 p-6 rounded-lg mb-6 flex flex-col items-center border border-indigo-200">

            <h4 class="font-semibold text-xl text-indigo-800 mb-3 flex items-center">

                <i data-lucide="scan" class="w-5 h-5 mr-2"></i>

                สแกน QR Code สำหรับลิงก์เว็บไซต์

            </h4>

            <div id="qrcode-display" class="my-4 p-4 bg-white rounded-lg shadow-inner inline-block">

                <div class="text-gray-500 text-sm">กำลังสร้าง QR Code...</div>

            </div>

            

            <button id="qr-download-btn" onclick="downloadQRCode()" class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition duration-150 shadow-md">

                <i data-lucide="download" class="inline w-5 h-5 mr-1"></i>

                ดาวน์โหลด QR Code (PNG)

            </button>

        </div>



        <h4 class="font-semibold text-xl text-indigo-700 mb-4 flex items-center">

            <i data-lucide="smartphone" class="w-5 h-5 mr-2"></i>

            คำแนะนำการติดตั้ง PWA

        </h4>

        <div class="space-y-4">

            <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-indigo-500">

                <h5 class="font-semibold text-lg text-indigo-700 mb-2">สำหรับ iPhone (iOS)</h5>

                <ol class="list-decimal list-inside text-gray-700 space-y-1">

                    <li>เปิดเว็บไซต์ด้วยเบราว์เซอร์ **Safari**</li>

                    <li>แตะที่ **ปุ่มแชร์** (<i data-lucide="share" class="inline w-4 h-4 text-indigo-500"></i>) ที่อยู่ด้านล่างของหน้าจอ</li>

                    <li>เลื่อนลงและเลือก **เพิ่มไปยังหน้าจอโฮม** (Add to Home Screen)</li>

                </ol>

            </div>



            <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-green-500">

                <h5 class="font-semibold text-lg text-green-700 mb-2">สำหรับ Android</h5>

                <ol class="list-decimal list-inside text-gray-700 space-y-1">

                    <li>เปิดเว็บไซต์ด้วยเบราว์เซอร์ **Chrome**</li>

                    <li>แตะที่ **ปุ่มเมนู** (จุดสามจุด) ที่มุมขวาบน</li>

                    <li>เลือก **ติดตั้งแอป** หรือ **เพิ่มไปยังหน้าจอหลัก** (Install app / Add to Home screen)</li>

                </ol>

            </div>

        </div>

    </div>

</div>



<div id="vr-container" class="hidden fixed inset-0 z-50 bg-black flex flex-col items-center justify-center w-screen h-screen">

    <video id="camera-feed" class="w-full h-full object-cover absolute inset-0" playsinline autoplay muted></video>

    

    <div class="relative z-10 w-full h-full p-4 flex flex-col justify-between items-center pointer-events-none">

        <div id="ar-message" class="bg-yellow-400 text-gray-900 font-bold p-3 rounded-xl shadow-xl text-center transition-opacity duration-500 opacity-0 pointer-events-auto">

            <p>กำลังค้นหาตำแหน่งของคุณ...</p>

        </div>



        <div class="flex flex-col items-center mt-auto mb-16 text-white text-center">

            <i id="ar-arrow" data-lucide="arrow-up" class="w-16 h-16 mb-2 animate-bounce drop-shadow-lg text-green-400"></i>

            <p id="ar-destination" class="text-3xl font-extrabold drop-shadow-lg bg-black/50 p-2 rounded-lg">มุ่งหน้าไปยัง: ห้อง 305 (ระยะทาง 15 ม.)</p>

        </div>

    </div>

    

    <button onclick="toggleVRMode()" class="absolute top-4 right-4 z-20 bg-red-600 hover:bg-red-700 text-white font-bold p-3 rounded-full shadow-lg flex items-center space-x-2 pointer-events-auto transition transform hover:scale-110">

        <i data-lucide="x" class="w-6 h-6"></i>

        <span class="text-sm hidden sm:inline">ปิด AR Mode</span>

    </button>



    <div id="error-message" class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-red-800 text-white p-6 rounded-xl shadow-2xl z-30 pointer-events-auto">

        <h3 class="text-xl font-bold mb-2">ไม่สามารถเปิดกล้องได้</h3>

        <p>โปรดตรวจสอบว่าคุณได้อนุญาตให้เว็บไซต์เข้าถึงกล้องแล้ว</p>

        <p class="text-sm mt-2">(คำเตือน: ฟังก์ชันกล้องต้องใช้การเชื่อมต่อแบบ **HTTPS**)</p>

        <button onclick="hideModal('error-message')" class="mt-4 bg-red-700 hover:bg-red-900 text-white font-bold py-2 px-4 rounded transition">รับทราบ</button>

    </div>

</div>





<script>

    // Initial load for icons

    lucide.createIcons(); 



    const homeSection = document.getElementById('home-section');

    const vrContainer = document.getElementById('vr-container');

    const cameraFeed = document.getElementById('camera-feed');

    const arMessage = document.getElementById('ar-message');

    const errorMessage = document.getElementById('error-message');

    let stream = null; // เก็บ stream ของกล้องไว้สำหรับหยุดการทำงาน

    let qrCodeInstance = null; // เก็บ instance ของ QRCode



    // ฟังก์ชันเปิด Modal

    window.showModal = function(id) {

        document.getElementById(id).classList.remove('hidden');

        lucide.createIcons(); // อัปเดตไอคอนใน Modal

        

        // ตรวจสอบว่า Modal ที่เปิดคือ Modal ติดตั้ง/QR

        if (id === 'install-qr-modal') {

            generateQRCodeForApp();

        }

    }



    // ฟังก์ชันปิด Modal

    window.hideModal = function(id) {

        document.getElementById(id).classList.add('hidden');

    }



    // ฟังก์ชันหลักในการสร้าง QR Code

    function generateQRCodeForApp() {

        // ใช้ URL ปัจจุบันของหน้าเว็บ (เมื่อนำไปโฮสต์จริง ลิงก์นี้จะถูกต้อง)

        const url = window.location.href; 

        const qrcodeDisplay = document.getElementById('qrcode-display');



        // ถ้ามี instance เก่าอยู่ ให้เคลียร์ก่อนสร้างใหม่

        if (qrcodeDisplay.firstChild && qrcodeDisplay.firstChild.tagName === 'CANVAS') {

            qrcodeDisplay.removeChild(qrcodeDisplay.firstChild);

        }

        if (qrcodeDisplay.firstChild && qrcodeDisplay.firstChild.tagName === 'IMG') {

            qrcodeDisplay.removeChild(qrcodeDisplay.firstChild);

        }

        

        // สร้าง instance ใหม่ทุกครั้งเพื่อให้แน่ใจว่า QR Code ถูกสร้างอย่างถูกต้อง

        qrCodeInstance = new QRCode(qrcodeDisplay, {

            text: url,

            width: 200,

            height: 200,

            colorDark: "#3730A3", // Indigo 800

            colorLight: "#ffffff",

            correctLevel: QRCode.CorrectLevel.H

        });

        

        // อัปเดตไอคอนภายใน Modal ที่เพิ่งเปิด

        lucide.createIcons();

    }



    // ฟังก์ชันสำหรับดาวน์โหลด QR Code เป็นไฟล์ PNG

    window.downloadQRCode = function() {

        const qrcodeDisplay = document.getElementById('qrcode-display');

        

        // QR Code สร้างด้วย qrcode.js จะเป็น <canvas> หรือ <img>

        const canvas = qrcodeDisplay.querySelector('canvas');

        const img = qrcodeDisplay.querySelector('img');

        

        let dataUrl;

        

        if (canvas) {

            dataUrl = canvas.toDataURL("image/png");

        } else if (img) {

            // ในบางเบราว์เซอร์ qrcode.js อาจสร้างเป็น <img>

            dataUrl = img.src; 

        }



        if (dataUrl) {

            const link = document.createElement('a');

            link.href = dataUrl;

            link.download = `srtc_vr_navigation_qrcode.png`;

            document.body.appendChild(link);

            link.click();

            document.body.removeChild(link);

        } else {

            console.error("QR Code image not found.");

            // ใช้กล่องข้อความแทน alert()

            document.getElementById('ar-message').innerHTML = '<p>เกิดข้อผิดพลาดในการดาวน์โหลด QR Code</p>';

            document.getElementById('ar-message').classList.remove('hidden', 'bg-green-500');

            document.getElementById('ar-message').classList.add('opacity-100', 'bg-red-500');

            setTimeout(() => {

                document.getElementById('ar-message').classList.add('hidden', 'opacity-0');

            }, 3000);

        }

    }





    // ฟังก์ชันสำหรับเริ่มต้นการทำงานของกล้อง

    async function startCamera() {

        // ซ่อนข้อความข้อผิดพลาดและแสดงข้อความสถานะ

        errorMessage.classList.add('hidden');

        arMessage.classList.remove('hidden');

        arMessage.classList.add('opacity-100');

        arMessage.classList.remove('bg-green-500');

        arMessage.classList.add('bg-yellow-400');

        arMessage.innerHTML = '<p>กำลังรอการอนุญาตเข้าถึงกล้อง...</p>';



        // เพิ่ม playsinline สำหรับ iOS เพื่อให้วิดีโอเล่นได้ในหน้าต่าง

        cameraFeed.setAttribute('playsinline', true);



        // กำหนดให้ใช้กล้องหลัง (environment) หากมี

        const constraints = { video: { facingMode: 'environment' } };



        try {

            // ขออนุญาตเข้าถึงกล้อง

            stream = await navigator.mediaDevices.getUserMedia(constraints);

            cameraFeed.srcObject = stream;

            // ต้องเรียก play() หลังจากตั้งค่า srcObject

            cameraFeed.play();

            

            // แสดงข้อความสถานะ AR เมื่อกล้องพร้อม

            setTimeout(() => {

                arMessage.innerHTML = '<p>ตำแหน่งถูกล็อค! พร้อมนำทาง</p>';

                arMessage.classList.remove('bg-yellow-400');

                arMessage.classList.add('bg-green-500'); 

            }, 1500);

            

        } catch (err) {

            console.error("Error accessing camera: ", err);

            

            // ซ่อน AR Message และแสดง Error Modal

            arMessage.classList.add('hidden', 'opacity-0');

            errorMessage.classList.remove('hidden');

            

            // หยุดการทำงานของกล้องหากมีการเริ่มแล้ว

            stopCamera();

        }

    }



    // ฟังก์ชันสำหรับหยุดการทำงานของกล้อง

    function stopCamera() {

        if (stream) {

            stream.getTracks().forEach(track => track.stop());

            stream = null;

            cameraFeed.srcObject = null;

        }

        arMessage.classList.add('opacity-0');

        arMessage.classList.remove('bg-green-500');

        arMessage.classList.add('hidden');

    }



    // ฟังก์ชันสำหรับสลับโหมด VR/AR

    window.toggleVRMode = function() {

        const isVRActive = vrContainer.classList.contains('hidden');



        if (isVRActive) {

            // เปิด VR/AR Mode

            homeSection.classList.add('hidden');

            vrContainer.classList.remove('hidden');

            startCamera();

        } else {

            // กลับสู่ Home Mode

            stopCamera();

            homeSection.classList.remove('hidden');

            vrContainer.classList.add('hidden');

        }

        

        // อัปเดตไอคอนอีกครั้ง

        lucide.createIcons();

    }

    

    // ตั้งค่า AR Element ให้หมุนตามเวลาเพื่อจำลองการแสดงผล (เพื่อความสวยงามเท่านั้น)

    const arArrow = document.getElementById('ar-arrow');

    setInterval(() => {

        if (vrContainer && !vrContainer.classList.contains('hidden')) {

             // ตัวอย่างการหมุนจำลอง

             const randomRotation = Math.floor(Math.random() * 20) - 10;

             arArrow.style.transform = `rotate(${randomRotation}deg)`;

        }

    }, 2000);



</script>



</body>

</html>
